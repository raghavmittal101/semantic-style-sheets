<?xml version="1.0" encoding="iso-8859-1"?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN"
               "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en">
<head>
<title>SweetSai - a Sweet based web app dev effort for Semantic Style Sheets</title>
<meta http-equiv="Content-Type" content="text/html;charset=iso-8859-1"/>
<meta name="title" content="SweetSai - a Sweet based web app dev effort for Semantic Style Sheets"/>
<meta name="generator" content="Org-mode"/>
<meta name="generated" content="2016-03-02T15:05+0530"/>
<meta name="author" content="Sai Gollapudi"/>
<meta name="description" content=""/>
<meta name="keywords" content=""/>
<style type="text/css">
 <!--/*--><![CDATA[/*><!--*/
  html { font-family: Times, serif; font-size: 12pt; }
  .title  { text-align: center; }
  .todo   { color: red; }
  .done   { color: green; }
  .tag    { background-color: #add8e6; font-weight:normal }
  .target { }
  .timestamp { color: #bebebe; }
  .timestamp-kwd { color: #5f9ea0; }
  .right  {margin-left:auto; margin-right:0px;  text-align:right;}
  .left   {margin-left:0px;  margin-right:auto; text-align:left;}
  .center {margin-left:auto; margin-right:auto; text-align:center;}
  p.verse { margin-left: 3% }
  pre {
	border: 1pt solid #AEBDCC;
	background-color: #F3F5F7;
	padding: 5pt;
	font-family: courier, monospace;
        font-size: 90%;
        overflow:auto;
  }
  table { border-collapse: collapse; }
  td, th { vertical-align: top;  }
  th.right  { text-align:center;  }
  th.left   { text-align:center;   }
  th.center { text-align:center; }
  td.right  { text-align:right;  }
  td.left   { text-align:left;   }
  td.center { text-align:center; }
  dt { font-weight: bold; }
  div.figure { padding: 0.5em; }
  div.figure p { text-align: center; }
  div.inlinetask {
    padding:10px;
    border:2px solid gray;
    margin:10px;
    background: #ffffcc;
  }
  textarea { overflow-x: auto; }
  .linenr { font-size:smaller }
  .code-highlighted {background-color:#ffff00;}
  .org-info-js_info-navigation { border-style:none; }
  #org-info-js_console-label { font-size:10px; font-weight:bold;
                               white-space:nowrap; }
  .org-info-js_search-highlight {background-color:#ffff00; color:#000000;
                                 font-weight:bold; }
  /*]]>*/-->
</style>
<script type="text/javascript">
/*
@licstart  The following is the entire license notice for the
JavaScript code in this tag.

Copyright (C) 2012-2013 Free Software Foundation, Inc.

The JavaScript code in this tag is free software: you can
redistribute it and/or modify it under the terms of the GNU
General Public License (GNU GPL) as published by the Free Software
Foundation, either version 3 of the License, or (at your option)
any later version.  The code is distributed WITHOUT ANY WARRANTY;
without even the implied warranty of MERCHANTABILITY or FITNESS
FOR A PARTICULAR PURPOSE.  See the GNU GPL for more details.

As additional permission under GNU GPL version 3 section 7, you
may distribute non-source (e.g., minimized or compacted) forms of
that code without the copy of the GNU GPL normally required by
section 4, provided you include this license notice and a URL
through which recipients can access the Corresponding Source.


@licend  The above is the entire license notice
for the JavaScript code in this tag.
*/
<!--/*--><![CDATA[/*><!--*/
 function CodeHighlightOn(elem, id)
 {
   var target = document.getElementById(id);
   if(null != target) {
     elem.cacheClassElem = elem.className;
     elem.cacheClassTarget = target.className;
     target.className = "code-highlighted";
     elem.className   = "code-highlighted";
   }
 }
 function CodeHighlightOff(elem, id)
 {
   var target = document.getElementById(id);
   if(elem.cacheClassElem)
     elem.className = elem.cacheClassElem;
   if(elem.cacheClassTarget)
     target.className = elem.cacheClassTarget;
 }
/*]]>*///-->
</script>

</head>
<body>

<div id="preamble">

</div>

<div id="content">
<h1 class="title">SweetSai - a Sweet based web app dev effort for Semantic Style Sheets</h1>


<div id="table-of-contents">
<h2>Table of Contents</h2>
<div id="text-table-of-contents">
<ul>
<li><a href="#sec-1">1 Introduction</a></li>
<li><a href="#sec-2">2 Requirements</a>
<ul>
<li><a href="#sec-2-1">2.1 overview of requirement</a></li>
<li><a href="#sec-2-2">2.2 roadmap of activity</a></li>
<li><a href="#sec-2-3">2.3 r0 - release 0 requirement</a></li>
</ul>
</li>
<li><a href="#sec-3">3 Design</a>
<ul>
<li><a href="#sec-3-1">3.1 installation information</a></li>
<li><a href="#sec-3-2">3.2 execution information</a></li>
<li><a href="#sec-3-3">3.3 server side</a>
<ul>
<li><a href="#sec-3-3-1">3.3.1 CORS</a></li>
<li><a href="#sec-3-3-2">3.3.2 SWeet Store API</a></li>
</ul>
</li>
<li><a href="#sec-3-4">3.4 client side</a></li>
<li><a href="#sec-3-5">3.5 Software Engineering aspects</a></li>
</ul>
</li>
<li><a href="#sec-4">4 implementation</a>
<ul>
<li><a href="#sec-4-1">4.1 basic layout &amp; structure</a></li>
<li><a href="#sec-4-2">4.2 Editor</a>
<ul>
<li><a href="#sec-4-2-1">4.2.1 model (database work)</a></li>
<li><a href="#sec-4-2-2">4.2.2 view</a></li>
<li><a href="#sec-4-2-3">4.2.3 my welcome page</a></li>
<li><a href="#sec-4-2-4">4.2.4 controller</a></li>
</ul>
</li>
<li><a href="#sec-4-3">4.3 support infra</a>
<ul>
<li><a href="#sec-4-3-1">4.3.1 Config.py file</a></li>
<li><a href="#sec-4-3-2">4.3.2 _<sub>init</sub>__.py file</a></li>
<li><a href="#sec-4-3-3">4.3.3 Authentication of user</a></li>
<li><a href="#sec-4-3-4">4.3.4 Macro for rendering WTF forms</a></li>
</ul></li>
</ul>
</li>
<li><a href="#sec-5">5 Installations</a></li>
<li><a href="#sec-6">6 Execution</a></li>
<li><a href="#sec-7">7 Server Side or Back-End Development work</a>
<ul>
<li><a href="#sec-7-1">7.1 Important code files</a></li>
<li><a href="#sec-7-2">7.2 SweetSai.py</a></li>
<li><a href="#sec-7-3">7.3 forms.py file</a></li>
<li><a href="#sec-7-4">7.4 my HTML files</a>
<ul>
<li><a href="#sec-7-4-1">7.4.1 core or base template</a></li>
<li><a href="#sec-7-4-2">7.4.2 navigation bar template</a></li>
<li><a href="#sec-7-4-3">7.4.3 how I intend to show sweets</a></li>
<li><a href="#sec-7-4-4">7.4.4 my page for getting Sweet User ID</a></li>
<li><a href="#sec-7-4-5">7.4.5 Submit page</a></li>
<li><a href="#sec-7-4-6">7.4.6 success page</a></li>
<li><a href="#sec-7-4-7">7.4.7 Here is my success page in HTML</a></li>
<li><a href="#sec-7-4-8">7.4.8 my logout page</a></li>
<li><a href="#sec-7-4-9">7.4.9 my LoginForm page</a></li>
<li><a href="#sec-7-4-10">7.4.10 style.css file</a></li>
</ul></li>
</ul>
</li>
<li><a href="#sec-8">8 Client-side or Front-End Development work</a>
<ul>
<li><a href="#sec-8-1">8.1 JavaScript code for front-end</a></li>
<li><a href="#sec-8-2">8.2 HTML code for front-end</a></li>
</ul>
</li>
<li><a href="#sec-9">9 clipboard</a></li>
</ul>
</div>
</div>

<div id="outline-container-1" class="outline-2">
<h2 id="sec-1"><span class="section-number-2">1</span> Introduction</h2>
<div class="outline-text-2" id="text-1">

<p>Essentially we are trying to implement the notion of Semantic Style
Sheets. Style Sheets essentially provide alternate views to one
singular content. In our case we wish to provide alternate narratives
to one singular narrative. The alternative narratives may be more
meaningful to end users. This idea of a more meaningful narrative is
what we are calling semantic. So, a semantic style sheet is a
renarrating a existing page into something that has more meaning to an
enduser.
</p>
<p>
The renarration of a page to a more meaningful version is a type of
page transformation. We see the page transformation involving new set
of parameters
</p><ul>
<li>'d' a data-structure (perhaps an ontology) to markup a page into a
  semantically meaningful setup. This is user-defined.
</li>
<li>'v' a data-structure (perhaps an ontology) to define the various
  communities to which viewer belongs to. This defines which view to
  show to a community of user.
</li>
<li>'r' this defines the renarration rules. This is also a
  data-structure (perhaps an ontology) which gives the various choices
  of renarration that are possible for a markup.
</li>
</ul>



</div>

</div>

<div id="outline-container-2" class="outline-2">
<h2 id="sec-2"><span class="section-number-2">2</span> Requirements</h2>
<div class="outline-text-2" id="text-2">


</div>

<div id="outline-container-2-1" class="outline-3">
<h3 id="sec-2-1"><span class="section-number-3">2.1</span> overview of requirement</h3>
<div class="outline-text-3" id="text-2-1">

<p>The overall aim is to develop a tool that would enable the following:
</p><ul>
<li>an editor environment
</li>
</ul>

<p>++ a user should be able to define a document structure (as an
 ontology). This we are calling as 'd' in our transformation function
+++ this ontology will initially be a simple data structure. Over time
 it will evolve into a more elaborate, user definable ontology.
++ a user should be able to import a web page by inputing a URL in the
 input text area
++ a user should be able to markup an input html doc with user defined tags (based on a user ontology, which we
  are calling 'd') 
</p>
<ul>
<li>a viewer environment 
</li>
</ul>

<p>++ a viewer where a user is allowed to see a marked-up file in a newly
renarrated manner
+++ for this to happen, the user is identified as part of a viewer
ontology called 'v'. Initially we will pre-define this ontology as a
simple data-structure. Over time this will evolve into a more
elaborate ontology that is user definable.
+++ there is also a rules for renarration 'r' that we will be using to
define how one must transform a marked-up content. This can be quite
elaborate. However, for the initial round, we will fix this to be a
simple structure and evolve it into a more complex ontology over time.
</p>

</div>

</div>

<div id="outline-container-2-2" class="outline-3">
<h3 id="sec-2-2"><span class="section-number-3">2.2</span> roadmap of activity</h3>
<div class="outline-text-3" id="text-2-2">

<p>This Semantic Style Sheet system will be developed in releases called
r0, r1, r2, r3&hellip; 
</p>
<ul>
<li>r0 - basic implementation of a python server, client side pages to
  input URLs, view web pages
</li>
<li>r1 - ability to markup a web page, adding a simple 'd'
</li>
<li>r2 - ability to persist the markup done in r1 (database)
</li>
<li>r3 - ability to input 'v' and 'r'
</li>
<li>etc.
</li>
</ul>



</div>

</div>

<div id="outline-container-2-3" class="outline-3">
<h3 id="sec-2-3"><span class="section-number-3">2.3</span> r0 - release 0 requirement</h3>
<div class="outline-text-3" id="text-2-3">

<ul>
<li>To develop a client server app using Python backend. 
</li>
<li>The UI should be sufficient to take on a URL.
</li>
<li>There should be an ability to view a userinput page.
</li>
</ul>



<p>
To develop a SweetApp. Aim of the app would be able to manipulate
Sweets. By manipulation I mean that I should be able to create and
query sweets of my own making. They should be independent of any
specific Sweet App. 
</p>

</div>
</div>

</div>

<div id="outline-container-3" class="outline-2">
<h2 id="sec-3"><span class="section-number-2">3</span> Design</h2>
<div class="outline-text-2" id="text-3">

<p>This pilot, experimental appliction is designed as a client server web
application. There is a server side and a client side to it. The
inspiration for this work comes from looking at other Sweet based apps
like Alipi, Swtr and Restory. These can be found [here :
<a href="https://github.com/janastu">https://github.com/janastu</a>] on github at janastu.
</p>

</div>

<div id="outline-container-3-1" class="outline-3">
<h3 id="sec-3-1"><span class="section-number-3">3.1</span> installation information</h3>
<div class="outline-text-3" id="text-3-1">

<ul>
<li>assuming we have Python, Flask, Jinja2, MongoDB already installed
</li>
<li>tangle the SweetSai.org file to get codeblocks. Some will be in the
  current directory, some will be in ./app directory, yet others in
  ./app/static, ./app/templates, ./app/static/css, and in
  ./app/static/js directories.
</li>
</ul>


</div>

</div>

<div id="outline-container-3-2" class="outline-3">
<h3 id="sec-3-2"><span class="section-number-3">3.2</span> execution information</h3>
<div class="outline-text-3" id="text-3-2">

<ul>
<li>the app will run on local host at 127.0.0.1:5000 port
</li>
<li>to run we need to activate the virtual environment of sweetEnv by
  typing ./sweetEnv/bin/activate
</li>
<li>to deactivate the virutatal environment, type in deactivate
</li>
<li>to execute this application, type in the virtual environment, the
  following: python SweetSai.py. Go to a browser and look for the app
  running at the 127.0.0.1:5000 local address.
</li>
</ul>


</div>

</div>

<div id="outline-container-3-3" class="outline-3">
<h3 id="sec-3-3"><span class="section-number-3">3.3</span> server side</h3>
<div class="outline-text-3" id="text-3-3">

<p>Initial design choices are based on reference works already done for
Sweets and similar apps. Some choices of technology include
</p><ul>
<li>Python 2.7 for scripting
</li>
<li>Flask (micro web development environment)
</li>
<li>WTF for forms
</li>
<li>Requests library for creating / handling HTTP requests
</li>
<li>sqlite database - I am using sqlite database for my work. For this
  we need to have Flask-sqlalchemy and sqlalchemy-migrate packages
  installed. As each database is stored in a single file and there is no need to start a database server, this is a
</li>
</ul>

<p>good choice for our application.
</p><ul>
<li>I am also opting to use MongoDb for persistence of information.
</li>
</ul>


<p>
When working with Node.js for AngularJS, I used npm package manager.
</p>

</div>

<div id="outline-container-3-3-1" class="outline-4">
<h4 id="sec-3-3-1"><span class="section-number-4">3.3.1</span> CORS</h4>
<div class="outline-text-4" id="text-3-3-1">

<p>In our initial part of the development we only needed to display the
Sweets that we could GET via the front-end app from the existing
back-end swtrstore (Sweet Store). To do this we could conceptually just rely on the frontend, which would be
develop using JavaScript. This would make HTTP GET request to the
Sweet Store and fetch us the HTML page with the Sweets, and then
essential display this gathered info.
</p>
<p>
There is one challenge to this design approach - CORS. CORS security
check would forbid the browser to do a cross-domain request to the
Sweet Store. That is, by design a Client (browser) should be
contacting the Server (Sweet Store). However, the Sweet Store server
(due to CORS) will not trust our domain and not accept our HTTP
requests. 
</p>
<p>
To overcome this, we are actually not anymore calling the Sweet Store
from the front-end web browser, but actually calling the store from
this back-end or server-side code. 
</p>
<p>
Due to this, we need to make our Client (Browser) talk to
our own trusted Server (written up in Python/Flask) and then, in turn,
have that local server be registered with Sweet Store as a trusted
domain and then, finally, have our trusted local domain work with Sweet
Store. The exchange between our trusted local domain Server and our
Client browser can happen using JSON objects - which need to be
formatted by the client for viewing on the client side. Essentially
the connectivity then is from our BrowserClient to our trusted Local
Server. This is in JSON. Then, our trusted Local Server then connects
with Sweet Store directly using Python/ Flask based HTTP protocol
(which does not incur CORS treatment). 
</p>

<p>
Here a Python code makes a request to the Sweet store, gathers the
Sweets from that using an API. This gathered info is in the form of a
JSON object. This sweet store furnished JSON object would then be
filtered on the front-end and then displayed.
</p>
<p>
If we just seek the <a href="http://teststore.swtr.us">Sweet Store Page</a>, we get the HTML output. But, we
can actually call in the API <a href="http://teststore.swtr.us/api/sweets/q?who=SaiGo">here</a>. This is where the Sweet Store API
rests. This API allows us to fetch the JSON objects.  
</p>
</div>

</div>

<div id="outline-container-3-3-2" class="outline-4">
<h4 id="sec-3-3-2"><span class="section-number-4">3.3.2</span> SWeet Store API</h4>
<div class="outline-text-4" id="text-3-3-2">

<p>Normal Sweet Store HTML page is available at
<a href="http://teststore.swtr.us">http://teststore.swtr.us</a>. The API is available at <a href="http://teststore.swtr.us/api/sweets/q?who=SaiGo">http://teststore.swtr.us/api/sweets/q?who=SaiGo</a> 
Post "q?" one can query who=&lt;userid&gt;, or what=&lt;context&gt;, or
where&lt;url&gt;. Or, have a combination of all of these. The connector is
the "&amp;" symbol. 
</p>
<p>
The object that is returned will be a JSON object. 
</p>
</div>
</div>

</div>

<div id="outline-container-3-4" class="outline-3">
<h3 id="sec-3-4"><span class="section-number-3">3.4</span> client side</h3>
<div class="outline-text-3" id="text-3-4">

<p>??Angular JS framework is being used for doing the FrontEnd JavaScript
development. For AngularJS package management (in the front-end), I
use Bower. Bower is to AngularJS what "npm" is to Node.js (in the
back-end). I use "Karma" the test runner for my Angular JS front-end.
</p>
</div>

</div>

<div id="outline-container-3-5" class="outline-3">
<h3 id="sec-3-5"><span class="section-number-3">3.5</span> Software Engineering aspects</h3>
<div class="outline-text-3" id="text-3-5">

<p>Software Engineering design choices include
</p><ul>
<li>using emacs-org-mode for Literate Programming 
</li>
<li>using Virtual Environments
</li>
<li>developing the app in multiple releases r0, r1, r2&hellip;
</li>
</ul>



</div>
</div>

</div>

<div id="outline-container-4" class="outline-2">
<h2 id="sec-4"><span class="section-number-2">4</span> implementation</h2>
<div class="outline-text-2" id="text-4">


</div>

<div id="outline-container-4-1" class="outline-3">
<h3 id="sec-4-1"><span class="section-number-3">4.1</span> basic layout &amp; structure</h3>
<div class="outline-text-3" id="text-4-1">

<p>Some of the coding and structure for this work has been inspired by a
tutorial by Miguel grinberg. 
[http://blog.miguelgrinberg.com/post/the-flask-mega-tutorial-part-iii-web-forms:
Here] is that tutorial.
</p>
<p>
Directory structure for this app is like this:
SweetSai/sweetEnv - for Virtual Environment
SweetSai/app - for packages
SweetSai/app/templates - for web based templates; html files
SweetSai/app/static - for static files
</p>

<p>
The development of this work has been done in two parts: Editor and
Viewer. Both have been implemented in the MVC design pattern.
</p>
</div>

</div>

<div id="outline-container-4-2" class="outline-3">
<h3 id="sec-4-2"><span class="section-number-3">4.2</span> Editor</h3>
<div class="outline-text-3" id="text-4-2">

<p>Editor has been implemented as a portal using Python, Flask, Jinja2
framework. It is being executed in a virtual environment. 
</p>
</div>

<div id="outline-container-4-2-1" class="outline-4">
<h4 id="sec-4-2-1"><span class="section-number-4">4.2.1</span> model (database work)</h4>
<div class="outline-text-4" id="text-4-2-1">

<ul>
<li id="sec-4-2-1-1">database related files<br/>
We chose sqlite database for our work. we had to update the config file with sqlite database related
constants: SQLALCHEMY<sub>DATABASE</sub><sub>URI</sub> and SQLALCHEMY<sub>MIGRATE</sub><sub>REPO</sub>.

<p>
we intialize our database in our init.py file.
</p>
<p>
our database is expressed as objects. This is defined in our models.py
file.
</p></li>
</ul>
<ul>
<li id="sec-4-2-1-2">models.py file<br/>
In the MVC architecture, this part &ndash; dealing with models &ndash; relates
to the models of the database and app that i have used.



<pre class="example">from app import db

# creating an object for a table named User
class User(db.Model):
   id            = db.Column(db.Integer,     primary_key = True)
   login_name    = db.Column(db.String(64),  index=True, unique=True)
   login_emailID = db.Column(db.String(120), index=True, unique=True)
   sweets        = db.relationship('Sweet', backref='author', lazy='dynamic')

   # should the user be allowed to authenticate?
   def is_authenticated(self):
       return True

   # banned users can be considered inactive    
   def is_active(self):
       return True

   # fake users who are not allowed to even log on
   def is_anonymous(self):
       return False

   # returns a unique identifier for user    
   def get_id(self):
       try:
           return unicode(self.id) # python 2
       except NameError:
          return str(self.id)      # python 3

   def __repr__(self):
       return '&lt;User %r&gt;' % (self.login_name)


class Sweet(db.Model):
   id        = db.Column(db.Integer,     primary_key=True)

   # the "s" in front represents the notion of a "sweet"; these are
   # attributes of a "sweet"
   sUsrname  = db.Column(db.String(64),  index=True, unique=True) #this is the Sweet user name
   sUrl      = db.Column(db.String(320), index=True, unique=True)
   sContext  = db.Column(db.String(64),  index=True, unique=True)
   sAttrib   = db.Column(db.Text,        index=True, unique=True)
   sTimestamp= db.Column(db.DateTime)
   sUser_id  = db.Column(db.Integer,     db.ForeignKey('user.id'))

   def __repr__(self):
       return '&lt;Sweet %r&gt;' % (self.sUsrname)

</pre>


</li>
</ul>
<ul>
<li id="sec-4-2-1-3">Table of Users<br/>
Definition for User table



<pre class="example"># creating an object for a table named User
class User(db.Model):
   id            = db.Column(db.Integer,     primary_key = True)
   login_name    = db.Column(db.String(64),  index=True, unique=True)
   login_emailID = db.Column(db.String(120), index=True, unique=True)
   sweets        = db.relationship('Sweet', backref='author', lazy='dynamic')

   # should the user be allowed to authenticate?
   def is_authenticated(self):
       return True

   # banned users can be considered inactive    
   def is_active(self):
       return True

   # fake users who are not allowed to even log on
   def is_anonymous(self):
       return False

   # returns a unique identifier for user    
   def get_id(self):
       try:
           return unicode(self.id) # python 2
       except NameError:
          return str(self.id)      # python 3

   def __repr__(self):
       return '&lt;User %r&gt;' % (self.login_name)

</pre>


</li>
</ul>
<ul>
<li id="sec-4-2-1-4">Table of Sweets<br/>
Definition for Sweet table. creating an object for a table named
Sweet. Sweet has its own ID&hellip; but it also has a link with User table one User can scribe multiple Sweets



<pre class="example">class Sweet(db.Model):
   id        = db.Column(db.Integer,     primary_key=True)

   # the "s" in front represents the notion of a "sweet"; these are
   # attributes of a "sweet"
   sUsrname  = db.Column(db.String(64),  index=True, unique=True) #this is the Sweet user name
   sUrl      = db.Column(db.String(320), index=True, unique=True)
   sContext  = db.Column(db.String(64),  index=True, unique=True)
   sAttrib   = db.Column(db.Text,        index=True, unique=True)
   sTimestamp= db.Column(db.DateTime)
   sUser_id  = db.Column(db.Integer,     db.ForeignKey('user.id'))

   def __repr__(self):
       return '&lt;Sweet %r&gt;' % (self.sUsrname)
</pre>



</li>
</ul>
<ul>
<li id="sec-4-2-1-5">db Creation script file: db<sub>create</sub>.py<br/>
Here is a python script that creates the database




<pre class="example">#!sweetEnv/bin/python

# the source for this comes from 
# http://blog.miguelgrinberg.com/post/the-flask-mega-tutorial-part-iv-database
# this is a database migration script used for moving from one to 
# another version of a database

from migrate.versioning import api
from config import SQLALCHEMY_DATABASE_URI
from config import SQLALCHEMY_MIGRATE_REPO
from app import db
import os.path

db.create_all()
if not os.path.exists(SQLALCHEMY_MIGRATE_REPO):
    api.create(SQLALCHEMY_MIGRATE_REPO, 'database repository')
    api.version_control(SQLALCHEMY_DATABASE_URI, SQLALCHEMY_MIGRATE_REPO)
else:
    api.version_control(SQLALCHEMY_DATABASE_URI, SQLALCHEMY_MIGRATE_REPO, api.version(SQLALCHEMY_MIGRATE_REPO))
</pre>


<p>
to create the database we just need to run the following python
command in our virtual environment:
</p>


<pre class="example">./db_create.py
</pre>

<p>
This will create a database with the label app.db file. This will be a
sqlite database. the script will also create a directory called
"db<sub>repository</sub>". This new directory wiill store the db migration files.
</p>

</li>
</ul>
<ul>
<li id="sec-4-2-1-6">db Migration script file: db<sub>migrate</sub>.py<br/>
migration is implemented to allow us to (in the future) to change the
model of the database. Here is a script in python to facilitate that.




<pre class="example">#!sweetEnv/bin/python
import imp
from migrate.versioning import api
from app import db
from config import SQLALCHEMY_DATABASE_URI
from config import SQLALCHEMY_MIGRATE_REPO

v = api.db_version(SQLALCHEMY_DATABASE_URI, SQLALCHEMY_MIGRATE_REPO)
migration = SQLALCHEMY_MIGRATE_REPO + ('/versions/%03d_migration.py' % (v+1))
tmp_module = imp.new_module('old_model')

old_model = api.create_model(SQLALCHEMY_DATABASE_URI, SQLALCHEMY_MIGRATE_REPO)
exec(old_model, tmp_module.__dict__)
script = api.make_update_script_for_model(SQLALCHEMY_DATABASE_URI, SQLALCHEMY_MIGRATE_REPO, tmp_module.meta, db.metadata)
open(migration, "wt").write(script)

api.upgrade(SQLALCHEMY_DATABASE_URI, SQLALCHEMY_MIGRATE_REPO)
v = api.db_version(SQLALCHEMY_DATABASE_URI, SQLALCHEMY_MIGRATE_REPO)

print('New migration saved as ' + migration)
print('Current database version: ' + str(v))
</pre>


<p>
To ensure proper migration tracking, try to not rename existing
fields. Limit changes to addition / deletion of fields only. Typing
can also be changed. Generated migration script can also be checked to
see if it is correct. 
</p>
<p>
migration script can be run by executing the following python script
in our virtual environment
</p>



<pre class="example">./db_migrate.py
</pre>

<p>
The script has print statements to show where the migration has been
stored. version number is also displayed by this script.
</p>




</li>
</ul>
<ul>
<li id="sec-4-2-1-7">db upgradation script file: db<sub>upgrade</sub>.py<br/>
This python script upgrades the sqlite database to the latest revision.



<pre class="example">#!sweetEnv/bin/python
from migrate.versioning import api
from config import SQLALCHEMY_DATABASE_URI
from config import SQLALCHEMY_MIGRATE_REPO

api.upgrade(SQLALCHEMY_DATABASE_URI, SQLALCHEMY_MIGRATE_REPO)
v = api.db_version(SQLALCHEMY_DATABASE_URI, SQLALCHEMY_MIGRATE_REPO)

print('Current database version: ' + str(v))
</pre>



</li>
</ul>
<ul>
<li id="sec-4-2-1-8">db downgrade script file: db<sub>downgrade</sub>.py<br/>
This python script downgrades the sqlite database by one version.



<pre class="example">#!sweetEnv/bin/python
from migrate.versioning import api
from config import SQLALCHEMY_DATABASE_URI
from config import SQLALCHEMY_MIGRATE_REPO

v = api.db_version(SQLALCHEMY_DATABASE_URI, SQLALCHEMY_MIGRATE_REPO)
api.downgrade(SQLALCHEMY_DATABASE_URI, SQLALCHEMY_MIGRATE_REPO, v - 1)
v = api.db_version(SQLALCHEMY_DATABASE_URI, SQLALCHEMY_MIGRATE_REPO)

print('Current database version: ' + str(v))
</pre>



</li>
</ul>
</div>

</div>

<div id="outline-container-4-2-2" class="outline-4">
<h4 id="sec-4-2-2"><span class="section-number-4">4.2.2</span> view</h4>
<div class="outline-text-4" id="text-4-2-2">

<p>This code represents the actions to be taken by the webapp when
various views are encountered. 
</p>


<pre class="example">from flask import (render_template, 
                   flash, 
                   redirect,
                   session, 
                   url_for, 
                   request, 
                   g,
                   abort )
from flask.ext.login import (login_user, 
                             logout_user, 
                             current_user,
                             login_required )
from app import app, db, lm
from .forms import get_swtIDForm, MyForm, LoginForm, InputURLform
from .models import User
import requests

@app.before_request
def get_current_user():
    g.user = None
    email = session.get('email')
    if email is not None:
        g.user = email

@app.route('/')
@app.route('/index')
def home_page():
    form = MyForm()
    return render_template('welcome.html', form=form)

@app.route('/showPg')
def showURL_page():
    return render_template('showPg.html', 
                           title='user_entered_page', 
                           url='www.google.com')

@app.route('/editor', methods=['GET', 'POST'])
def my_editor():
    form = InputURLform(request.form) 

    # this is activated when the form is filled by user
    if request.method == 'POST' and form.validate():
         url = form.url.data
         return redirect('showPg.html', 
                           title='user_entered_page', 
                           url=url)
    return render_template('inputURLform.html',
                           title='input URL',
                           form=form)

@app.route('/_auth/login', methods=['GET', 'POST'])
def login_handler():
    """This is used by the persona.js file to kick off the
    verification securely from the server side.  If all is okay
    the email address is remembered on the server.
    """
    resp = requests.post(app.config['PERSONA_VERIFIER'], data={
        'assertion': request.form['assertion'],
        'audience': request.host_url,
    }, verify=True)
    if resp.ok:
        verification_data = resp.json()
        if verification_data['status'] == 'okay':
            session['email'] = verification_data['email']
            return 'OK'
    abort(400)

@app.route('/_auth/logout', methods=['POST'])
def logout_handler():
    """This is what persona.js will call to sign the user
    out again.
    """
    session.clear()
    return 'OK'

@app.route('/get_swtID', methods=['GET', 'POST'])
def get_swtID():
    form = get_swtIDForm()
    return render_template('get_swtID.html',
                           title='Sign In',
                           form=form)

@app.route('/login', methods=['GET', 'POST'])
def login():
    form = LoginForm()
    if form.validate_on_submit():
       login_user(user)
       flask.flash('logged in successfully')

       next = flask.request.args.get('next')
       if not next_is_valid(next):
          return flask.abort(400)

       return flask.redirect(next or flask.url_for('/index'))
    return render_template('login.html', form=form)

@app.route('/submit', methods=('GET', 'POST'))
def submit():
    form = MyForm()
    if form.validate_on_submit():
        return redirect('/success')
    return render_template('submit.html', form=form)

@lm.user_loader
def load_user(id):
    # user Id from Flask-Login is unicode, thats why we need to convert
    # to int before sending it to database (SQLAlchemy) pkg
    return User.query.get(int(id))  

if __name__ == '__main__':
    app.run()

</pre>



<ul>
<li id="sec-4-2-2-1">View for my editor<br/>
Editor is basically a web portal. It has an ability to markup a web
page. User inputs the web page by typing in an URL in a text box. The
web page is marked up along the lines of the data structure 'd' of our
transformation function.

<p>
Here is the backend view for inputing the URL by the user. This URL is the
page that the user will edit in the editor. It will be the one with
the markup.
</p>


<pre class="example">@app.route('/editor', methods=['GET', 'POST'])
def my_editor():
    form = InputURLform(request.form) 

    # this is activated when the form is filled by user
    if request.method == 'POST' and form.validate():
         url = form.url.data
         return redirect('showPg.html', 
                           title='user_entered_page', 
                           url=url)
    return render_template('inputURLform.html',
                           title='input URL',
                           form=form)
</pre>



<p>
User inputs the URL of the page he / she wishes to browse into this
page.
</p>


<pre class="example">&lt;!-- extend from base coreLayout.html --&gt;
{% extends "coreLayout.html" %}

{% block body %}
{% from "_formhelpers.html" import render_field %}
&lt;form method=post action="/editor"&gt;
   &lt;dl&gt;
       {{ render_field(form.url) }}
   &lt;/dl&gt;
   &lt;p&gt; &lt;input type=submit value=submit&gt;
&lt;/form&gt;
{% endblock %}
</pre>


<p>
This is the front-end view for showcasing the page which is to be
edited for markup. 
</p>


<pre class="example">{% extends "coreLayout.html" %}
{% block body %}
   &lt;iframe frameborder='0' noresize='noresize' style='position: absolute; background: transparent; width: 100%; height:100%;' src="{{ url  }}" frameborder="0"&gt;&lt;/iframe&gt;   
{% endblock %}
</pre>



</li>
</ul>
<ul>
<li id="sec-4-2-2-2">View for showing the page given by the user's URL<br/>
Here is the code for the showall view, which is used for seeing all
the sweets.



<pre class="example">@app.route('/showPg')
def showURL_page():
    return render_template('showPg.html', 
                           title='user_entered_page', 
                           url='www.google.com')
</pre>


</li>
</ul>
<ul>
<li id="sec-4-2-2-3">View for Index<br/>
Here is the code for the index view. It also is used for "/" view.



<pre class="example">@app.route('/')
@app.route('/index')
def home_page():
    form = MyForm()
    return render_template('welcome.html', form=form)
</pre>


<p>
Here is the html code for the welcome  page. It includes a patch fix.
</p></li>
</ul>
</div>

</div>

<div id="outline-container-4-2-3" class="outline-4">
<h4 id="sec-4-2-3"><span class="section-number-4">4.2.3</span> my welcome page</h4>
<div class="outline-text-4" id="text-4-2-3">




<pre class="example">&lt;!doctype&gt;
&lt;head&gt;
  &lt;style type="text/css" rel="stylesheet"&gt;
  #inputurl {
  width:85%;
  height:35px;
  background-color:#efd;
  }
  button {
  width:12%;
  background-color:#4d9;
  height:36px;
  font-size:20px;
  font-style:italic;
}
&lt;/style&gt;
  &lt;title&gt; Renarrator &lt;/title&gt;
  &lt;p&gt;
   &lt;br&gt; this is a Sweets based web application tool
   &lt;br&gt; creator: Sai Gollapudi
   &lt;br&gt;
   &lt;br&gt; the purpose is to be able to do SSS
  &lt;/p&gt;

  &lt;script type="text/javascript"&gt;
    function wget() {
        foruri = document.getElementById("inputurl").value;
        if(foruri.substring(0,7) == "http://") {
           if(window.location.href == "http://dev.a11y.in/server/")    {
              window.open("http://dev.a11y.in/web?foruri=" + encodeURIComponent(foruri));
           }
           else {
              window.open("http://127.0.0.1:5000/?foruri=" + encodeURIComponent(foruri));
           }
        }
        else if (foruri.substring(0,8) == "https://") {
           window.open("http://127.0.0.1:5000/?foruri=" + encodeURIComponent(foruri));
        }
        else {
           alert("Please enter 'HTTP' protocoled URL");
        }
    }
  &lt;/script&gt;
&lt;/head&gt;

&lt;body&gt;
  &lt;fieldset&gt;
    &lt;legend&gt; Enter a URL  &lt;/legend&gt;
  &lt;input id="inputurl" placeholder="http://a11y.in/" /&gt;
  &lt;button type="submit" onClick="wget()"&gt; Get&lt;/button&gt;
  &lt;/fieldset&gt;
&lt;/body&gt;
&lt;/html&gt;

</pre>





</div>

</div>

<div id="outline-container-4-2-4" class="outline-4">
<h4 id="sec-4-2-4"><span class="section-number-4">4.2.4</span> controller</h4>
<div class="outline-text-4" id="text-4-2-4">




</div>
</div>

</div>

<div id="outline-container-4-3" class="outline-3">
<h3 id="sec-4-3"><span class="section-number-3">4.3</span> support infra</h3>
<div class="outline-text-3" id="text-4-3">


</div>

<div id="outline-container-4-3-1" class="outline-4">
<h4 id="sec-4-3-1"><span class="section-number-4">4.3.1</span> Config.py file</h4>
<div class="outline-text-4" id="text-4-3-1">

<p>Before the app is launched we need to configure the various parameters
for use by the app. A config.py file has been setup for this purpose.
</p>
<p>
In this file we are configuring the authentication done by
Mozilla. the code related to Persona.js is dealing with this.
</p>
<p>
We are also configuring the mongodb.
</p>



<pre class="example">#to make the WTF forms in app highly secure 
WTF_CSRF_ENABLED = True  #this is for cross-site request forgery prevention
SECRET_KEY = '_Aum_JaiSaiRam,SuperD00perSecretKey_ThatUwillN0T_b_ab1E_2_GUESS?' # needed when CSRF is enabled; this makes a cryptographic token

import os
basedir = os.path.abspath(os.path.dirname(__file__))

#configuration info for the Mozilla Persona authorization work
PERSONA_JS='https://login.persona.org/include.js'
PERSONA_VERIFIER='https://verifier.login.persona.org/verify'

# sqlite database related constants
SQLALCHEMY_DATABASE_URI = 'sqlite:///' + os.path.join(basedir, 'app.db') # path to our database
SQLALCHEMY_MIGRATE_REPO = os.path.join(basedir, 'db_repository') # folder where we will store the SQLAlchemy migrate files.
</pre>


</div>

</div>

<div id="outline-container-4-3-2" class="outline-4">
<h4 id="sec-4-3-2"><span class="section-number-4">4.3.2</span> _<sub>init</sub>__.py file</h4>
<div class="outline-text-4" id="text-4-3-2">

<p>When invoking the package called "app" I create my app object and
initialize it.
</p>



<pre class="example">import os
from flask import Flask
from flask.ext.login import LoginManager
from config import basedir
from flask.ext.sqlalchemy import SQLAlchemy

app = Flask(__name__)
app.config.from_object('config')

# creation database 
db = SQLAlchemy(app) # creating a db object which represents our database

# creation of login manager
lm = LoginManager()
lm.init_app(app)

# to avoid circular references we wait till application is loaded
from app import views, models
</pre>


</div>

</div>

<div id="outline-container-4-3-3" class="outline-4">
<h4 id="sec-4-3-3"><span class="section-number-4">4.3.3</span> Authentication of user</h4>
<div class="outline-text-4" id="text-4-3-3">

<ul>
<li id="sec-4-3-3-1">Mozilla Persona based authentication<br/>
I am using mozilla Persona based authentication. This requires Flask
as well as "requests" libraries.

<p>
Personas require us to do some work before any requests come in the views
file.
</p></li>
</ul>
<ul>
<li id="sec-4-3-3-2">Persona.js file<br/>



<pre class="example">$(function() {
  /* convert the links into clickable buttons that go to the
     persona service */
  $('a.signin').on('click', function() {
    navigator.id.request({
      siteName: 'SweetSai App'
    });
    return false;
  });

  $('a.signout').on('click', function() {
    navigator.id.logout();
    return false;
  });

  /* watch persona state changes */
  navigator.id.watch({
    loggedInUser: $CURRENT_USER,
    onlogin: function(assertion) {
      /* because the login needs to verify the provided assertion
         with the persona service which requires an HTTP request,
         this could take a bit.  To not confuse the user we show
         a progress box */
      var box = $('&lt;div class=signinprogress&gt;&lt;/div&gt;')
        .hide()
        .text('Please wait ...')
        .appendTo('body')
        .fadeIn('fast');
      $.ajax({
        type: 'POST',
        url: $URL_ROOT + '_auth/login',
        data: {assertion: assertion},
        success: function(res, status, xhr) { window.location.reload(); },
        error: function(xhr, status, err) {
          box.remove();
          navigator.id.logout();
          alert('Login failure: ' + err);
        }
      });
    },
    onlogout: function() {
      $.ajax({
        type: 'POST',
        url: $URL_ROOT + '_auth/logout',
        success: function(res, status, xhr) { window.location.reload(); },
        error: function(xhr, status, err) {
          alert('Logout failure: ' + err);
        }
      });
    }
  });
});
</pre>


</li>
</ul>
<ul>
<li id="sec-4-3-3-3">Persona Based Authentication<br/>
Here is the code for the Mozilla's Persona based Login view. The code
for this is derived from <a href="https://github.com/mitsuhiko/flask/blob/master/examples/persona/persona.py">https://github.com/mitsuhiko/flask/blob/master/examples/persona/persona.py</a>"



<pre class="example">@app.route('/_auth/login', methods=['GET', 'POST'])
def login_handler():
    """This is used by the persona.js file to kick off the
    verification securely from the server side.  If all is okay
    the email address is remembered on the server.
    """
    resp = requests.post(app.config['PERSONA_VERIFIER'], data={
        'assertion': request.form['assertion'],
        'audience': request.host_url,
    }, verify=True)
    if resp.ok:
        verification_data = resp.json()
        if verification_data['status'] == 'okay':
            session['email'] = verification_data['email']
            return 'OK'
    abort(400)
</pre>


<p>
Here is the code for the Mozilla's Persona based Logout view. The code
for this is derived from <a href="https://github.com/mitsuhiko/flask/blob/master/examples/persona/persona.py">https://github.com/mitsuhiko/flask/blob/master/examples/persona/persona.py</a>"
</p>


<pre class="example">@app.route('/_auth/logout', methods=['POST'])
def logout_handler():
    """This is what persona.js will call to sign the user
    out again.
    """
    session.clear()
    return 'OK'
</pre>


</li>
</ul>
</div>

</div>

<div id="outline-container-4-3-4" class="outline-4">
<h4 id="sec-4-3-4"><span class="section-number-4">4.3.4</span> Macro for rendering WTF forms</h4>
<div class="outline-text-4" id="text-4-3-4">

<p>I am using a macro to render the fields in the forms. here is that
macro that WTF uses. It is inspired by the user manual examples of WTF.
</p>


<pre class="example">{% macro render_field(field) %}
  &lt;dt&gt;{{ field.label }}
  &lt;dd&gt;{{ field(**kwargs)|safe }}
  {% if field.errors %}
    &lt;ul class=errors&gt;
    {% for error in field.errors %}
      &lt;li&gt;{{ error }}&lt;/li&gt;
    {% endfor %}
    &lt;/ul&gt;
  {% endif %}
  &lt;/dd&gt;
{% endmacro %}

</pre>



</div>
</div>
</div>

</div>

<div id="outline-container-5" class="outline-2">
<h2 id="sec-5"><span class="section-number-2">5</span> Installations</h2>
<div class="outline-text-2" id="text-5">


</div>

</div>

<div id="outline-container-6" class="outline-2">
<h2 id="sec-6"><span class="section-number-2">6</span> Execution</h2>
<div class="outline-text-2" id="text-6">

<p>My source file needs to be executable. So I need to change the
Read,Write, Execute settings of my basic Python file. Here is where I
do that.
</p>



<pre class="example">chmod a+x /SweetSai.py
</pre>



</div>

</div>

<div id="outline-container-7" class="outline-2">
<h2 id="sec-7"><span class="section-number-2">7</span> Server Side or Back-End Development work</h2>
<div class="outline-text-2" id="text-7">



</div>

<div id="outline-container-7-1" class="outline-3">
<h3 id="sec-7-1"><span class="section-number-3">7.1</span> Important code files</h3>
<div class="outline-text-3" id="text-7-1">

<p>I am using Model View Control architecture for this app. The Models
are contained in models.py file. The views are contained in views.py
file. 
</p>
<p>
The app package contains forms.py and several html forms. 
</p>
<p>
Config.py file is used to initialize key variables with their values.
</p>
<p>
The initial file which launches the app is SweetSai.py file.
</p>

</div>

</div>

<div id="outline-container-7-2" class="outline-3">
<h3 id="sec-7-2"><span class="section-number-3">7.2</span> SweetSai.py</h3>
<div class="outline-text-3" id="text-7-2">




<pre class="example">#!sweetEnv/bin/python
from app import app

app.run(debug=True)
#app.run(debug=True, host='0.0.0.0', port=5001)

# for setting up the MongoDB
from flask.ext.pymongo import PyMongo 

# PyMongo connects to the MongoDB server running on port 27017 
# on localhost, and assumes a default database name of app.name 
# (i.e. whatever name you pass to Flask). 
# This database is exposed as the db attribute.
mongo = PyMongo(app)
</pre>



</div>

</div>

<div id="outline-container-7-3" class="outline-3">
<h3 id="sec-7-3"><span class="section-number-3">7.3</span> forms.py file</h3>
<div class="outline-text-3" id="text-7-3">

<p>For Authentication I am using Flask-WTF extension. I am also creating a Forms.py
</p>


<pre class="example">from flask.ext.wtf import Form
from wtforms import TextField, StringField, BooleanField, validators
from wtforms.validators import DataRequired

class get_swtIDForm(Form):
   usr_name = StringField('usr_name', validators=[DataRequired()])
   remember_me = BooleanField('remember_me', default=False)

class MyForm(Form):
   usr_name = StringField('usr_name', validators=[DataRequired()])

class LoginForm(Form):
   usr_name = StringField('usr_name', validators=[DataRequired()])
   remember_me = BooleanField('remember_me', default=False)

class InputURLform(Form):
   url = StringField('url being modified', validators=[DataRequired()])

</pre>



</div>

</div>

<div id="outline-container-7-4" class="outline-3">
<h3 id="sec-7-4"><span class="section-number-3">7.4</span> my HTML files</h3>
<div class="outline-text-3" id="text-7-4">


</div>

<div id="outline-container-7-4-1" class="outline-4">
<h4 id="sec-7-4-1"><span class="section-number-4">7.4.1</span> core or base template</h4>
<div class="outline-text-4" id="text-7-4-1">

<p>There is a core template upon which various views are built (or
appended). Here is that core skeleton that is elsewhere enhanced to
show various other views.
</p>


<pre class="example">
&lt;!DOCTYPE html&gt;
&lt;html&gt;
       &lt;meta name="viewport" content="width=device-width, initial-scale=1.0"&gt;
       &lt;link href="http://netdna.bootstrapcdn.com/bootstrap/3.0.0/css/bootstrap.min.css" rel="stylesheet" media="screen"&gt;
       &lt;style type="text/css"&gt;
         .container {
           max-width: 900px;
           padding-top: 10px;
         }
         h2 {color: red;}
       &lt;/style&gt;

       &lt;!-- will use nav-link macro to highlight the one that we are on --&gt;
       {% from "NavMacro.html" import nav_link with context %}

    &lt;nav class="navbar navbar-inverse" role="navigation"&gt;
     &lt;div class="container-fluid"&gt;
       &lt;div class="navbar-header"&gt;
         &lt;button type="button" class="navbar-toggle" data-toggle="collapse" data-target="#bs-example-navbar-collapse-1"&gt;
           &lt;span class="sr-only"&gt;Toggle navigation&lt;/span&gt;
           &lt;span class="icon-bar"&gt;&lt;/span&gt;
           &lt;span class="icon-bar"&gt;&lt;/span&gt;
           &lt;span class="icon-bar"&gt;&lt;/span&gt;
         &lt;/button&gt;
         &lt;a class="navbar-brand" href="/index"&gt;Home&lt;/a&gt;
       &lt;/div&gt;

       &lt;div class="collapse navbar-collapse" id="bs-example-navbar-collapse-1"&gt;
         &lt;ul class="nav navbar-nav"&gt;
           &lt;li class="active"&gt;&lt;a href="/login"&gt;Login&lt;/a&gt;&lt;/li&gt;
           &lt;li&gt;&lt;a href="/editor"&gt;Editor&lt;/a&gt;&lt;/li&gt;
           &lt;li&gt;&lt;a href="/showPg"&gt;ShowPg&lt;/a&gt;&lt;/li&gt;
           &lt;li&gt;&lt;a href="/showall"&gt;Showall &lt;/a&gt;&lt;/li&gt;
         &lt;/ul&gt;

         &lt;!-- search mechanism
         &lt;form class="navbar-form navbar-left" role="search"&gt;
           &lt;div class="form-group"&gt;
             &lt;input type="text" class="form-control" placeholder="Search"&gt;
           &lt;/div&gt;
           &lt;button type="submit" class="btn btn-default"&gt;Submit&lt;/button&gt;
         &lt;/form&gt;
         //--&gt;

         &lt;ul class="nav navbar-nav navbar-right"&gt;
           &lt;li&gt;&lt;a href="#"&gt;DefineSweet&lt;/a&gt;&lt;/li&gt;
           &lt;li class="dropdown"&gt;
             &lt;a href="#" class="dropdown-toggle" data-toggle="dropdown"&gt;User&lt;b class="caret"&gt;&lt;/b&gt;&lt;/a&gt;
             &lt;ul class="dropdown-menu"&gt;
               &lt;li&gt;&lt;a href="/login"&gt;Login&lt;/a&gt;&lt;/li&gt;
               &lt;li&gt;&lt;a href="#"&gt;About&lt;/a&gt;&lt;/li&gt;
               &lt;li&gt;&lt;a href="#"&gt;Action 1&lt;/a&gt;&lt;/li&gt;
               &lt;li&gt;&lt;a href="#"&gt;Action 2&lt;/a&gt;&lt;/li&gt;
               &lt;li class="divider"&gt;&lt;/li&gt;
               &lt;li&gt;&lt;a href="/logout"&gt;Signout&lt;/a&gt;&lt;/li&gt;
             &lt;/ul&gt;
           &lt;/li&gt;
         &lt;/ul&gt;
       &lt;/div&gt;&lt;!-- /.navbar-collapse --&gt;
     &lt;/div&gt;&lt;!-- /.container-fluid --&gt;
   &lt;/nav&gt;
   &lt;link rel=stylesheet type=text/css href="{{ url_for('static', filename='css/style.css') }}"&gt;
   &lt;head&gt; 
      {% if title %}
         &lt;title&gt; SWeeTapp - {{ title }} &lt;/title&gt;
      {% else %}
         &lt;title&gt; SWeeTapp &lt;/title&gt;
      {% endif %}     
   &lt;/head&gt;

   &lt;meta http-equiv="X-UA-Compatible" content="IE=Edge"&gt;
   &lt;script src="{{ config.PERSONA_JS }}"&gt;&lt;/script&gt;
   &lt;script src="//ajax.googleapis.com/ajax/libs/jquery/1.10.1/jquery.min.js"&gt;&lt;/script&gt;
   &lt;script&gt;
     /* the url root is useful for doing HTTP requests */
     var $URL_ROOT = {{ request.url_root|tojson }};
     /* we store the current user here so that the persona
        javascript support knows about the current user */
     var $CURRENT_USER = {{ g.user|tojson }};
   &lt;/script&gt;
   &lt;script src="{{ url_for('static', filename='js/persona.js') }}"&gt;&lt;/script&gt;
   &lt;link rel="stylesheet" href="{{ url_for('static', filename='css/style.css') }}"&gt;  

   &lt;header&gt;
      &lt;h1&gt;SweetSai &lt;/h1&gt;
      &lt;div class="authbar"&gt;
        {% if g.user %}
          Signed in as &lt;em&gt;{{ g.user }}&lt;/em&gt;
          (&lt;a href="#" class="signout"&gt;Sign out&lt;/a&gt;)
        {% else %}
          Not signed in. &lt;a href="#" class="signin"&gt;Sign in&lt;/a&gt;
        {% endif %}
      &lt;/div&gt;
   &lt;/header&gt;

   &lt;body&gt;
     &lt;div class="container"&gt;
     {% block body %}{% endblock %}
     &lt;/div&gt;
     &lt;script src="http://code.jquery.com/jquery-1.10.2.min.js"&gt;&lt;/script&gt;
     &lt;script src="http://netdna.bootstrapcdn.com/bootstrap/3.0.0/js/bootstrap.min.js"&gt;&lt;/script&gt;
   &lt;/body&gt;

&lt;/html&gt;
</pre>


<p>
Here is the html content for launching the nav bar
</p>


<pre class="example">    &lt;meta name="viewport" content="width=device-width, initial-scale=1.0"&gt;
    &lt;link href="http://netdna.bootstrapcdn.com/bootstrap/3.0.0/css/bootstrap.min.css" rel="stylesheet" media="screen"&gt;
    &lt;style type="text/css"&gt;
      .container {
        max-width: 900px;
        padding-top: 10px;
      }
      h2 {color: red;}
    &lt;/style&gt;

    &lt;!-- will use nav-link macro to highlight the one that we are on --&gt;
    {% from "NavMacro.html" import nav_link with context %}

 &lt;nav class="navbar navbar-inverse" role="navigation"&gt;
  &lt;div class="container-fluid"&gt;
    &lt;div class="navbar-header"&gt;
      &lt;button type="button" class="navbar-toggle" data-toggle="collapse" data-target="#bs-example-navbar-collapse-1"&gt;
        &lt;span class="sr-only"&gt;Toggle navigation&lt;/span&gt;
        &lt;span class="icon-bar"&gt;&lt;/span&gt;
        &lt;span class="icon-bar"&gt;&lt;/span&gt;
        &lt;span class="icon-bar"&gt;&lt;/span&gt;
      &lt;/button&gt;
      &lt;a class="navbar-brand" href="/index"&gt;Home&lt;/a&gt;
    &lt;/div&gt;

    &lt;div class="collapse navbar-collapse" id="bs-example-navbar-collapse-1"&gt;
      &lt;ul class="nav navbar-nav"&gt;
        &lt;li class="active"&gt;&lt;a href="/login"&gt;Login&lt;/a&gt;&lt;/li&gt;
        &lt;li&gt;&lt;a href="/editor"&gt;Editor&lt;/a&gt;&lt;/li&gt;
        &lt;li&gt;&lt;a href="/showPg"&gt;ShowPg&lt;/a&gt;&lt;/li&gt;
        &lt;li&gt;&lt;a href="/showall"&gt;Showall &lt;/a&gt;&lt;/li&gt;
      &lt;/ul&gt;

      &lt;!-- search mechanism
      &lt;form class="navbar-form navbar-left" role="search"&gt;
        &lt;div class="form-group"&gt;
          &lt;input type="text" class="form-control" placeholder="Search"&gt;
        &lt;/div&gt;
        &lt;button type="submit" class="btn btn-default"&gt;Submit&lt;/button&gt;
      &lt;/form&gt;
      //--&gt;

      &lt;ul class="nav navbar-nav navbar-right"&gt;
        &lt;li&gt;&lt;a href="#"&gt;DefineSweet&lt;/a&gt;&lt;/li&gt;
        &lt;li class="dropdown"&gt;
          &lt;a href="#" class="dropdown-toggle" data-toggle="dropdown"&gt;User&lt;b class="caret"&gt;&lt;/b&gt;&lt;/a&gt;
          &lt;ul class="dropdown-menu"&gt;
            &lt;li&gt;&lt;a href="/login"&gt;Login&lt;/a&gt;&lt;/li&gt;
            &lt;li&gt;&lt;a href="#"&gt;About&lt;/a&gt;&lt;/li&gt;
            &lt;li&gt;&lt;a href="#"&gt;Action 1&lt;/a&gt;&lt;/li&gt;
            &lt;li&gt;&lt;a href="#"&gt;Action 2&lt;/a&gt;&lt;/li&gt;
            &lt;li class="divider"&gt;&lt;/li&gt;
            &lt;li&gt;&lt;a href="/logout"&gt;Signout&lt;/a&gt;&lt;/li&gt;
          &lt;/ul&gt;
        &lt;/li&gt;
      &lt;/ul&gt;
    &lt;/div&gt;&lt;!-- /.navbar-collapse --&gt;
  &lt;/div&gt;&lt;!-- /.container-fluid --&gt;
&lt;/nav&gt;
</pre>


<p>
Here is the macro I use to ensure that my navigator bar highlights the
page that I am actively on.
</p>


<pre class="example">{% macro nav_link(endpoint, name) %}
{% if request.endpoint.endswith(endpoint) %}
  &lt;li class="active"&gt;&lt;a href="{{ url_for(endpoint) }}"&gt;{{name}}&lt;/a&gt;&lt;/li&gt;
{% else %}
  &lt;li&gt;&lt;a href="{{ url_for(endpoint) }}"&gt;{{name}}&lt;/a&gt;&lt;/li&gt;
{% endif %}
{% endmacro %}
</pre>


<p>
Here is the content for dealing with Mozilla's Persona based
authentication
</p>


<pre class="example">&lt;meta http-equiv="X-UA-Compatible" content="IE=Edge"&gt;
&lt;script src="{{ config.PERSONA_JS }}"&gt;&lt;/script&gt;
&lt;script src="//ajax.googleapis.com/ajax/libs/jquery/1.10.1/jquery.min.js"&gt;&lt;/script&gt;
&lt;script&gt;
  /* the url root is useful for doing HTTP requests */
  var $URL_ROOT = {{ request.url_root|tojson }};
  /* we store the current user here so that the persona
     javascript support knows about the current user */
  var $CURRENT_USER = {{ g.user|tojson }};
&lt;/script&gt;
&lt;script src="{{ url_for('static', filename='js/persona.js') }}"&gt;&lt;/script&gt;
&lt;link rel="stylesheet" href="{{ url_for('static', filename='css/style.css') }}"&gt;  
</pre>


<p> 
Here is code for indicating the status of user authentication 
</p>


<pre class="example">&lt;div class="authbar"&gt;
  {% if g.user %}
    Signed in as &lt;em&gt;{{ g.user }}&lt;/em&gt;
    (&lt;a href="#" class="signout"&gt;Sign out&lt;/a&gt;)
  {% else %}
    Not signed in. &lt;a href="#" class="signin"&gt;Sign in&lt;/a&gt;
  {% endif %}
&lt;/div&gt;
</pre>


</div>

</div>

<div id="outline-container-7-4-2" class="outline-4">
<h4 id="sec-7-4-2"><span class="section-number-4">7.4.2</span> navigation bar template</h4>
<div class="outline-text-4" id="text-7-4-2">




<pre class="example">{% extends "coreLayout.html" %}
{% set active_page = "index" %}

{% set navigation_bar = [
   ('/', 'index', 'Index'),
   ('/login/', 'login, 'Login'),
   ('/logout/', 'logout', 'Logout),
   ('/inputurl/', 'inputurl', 'InputURL')
] -%}
{% set active_page = active_page | default('index') -%}

&lt;ul id="navigation"&gt;
   {% for href, id, caption in navigation_bar %}
      &lt;li {% if id == active_page %} class="active" 
          {% endif %}&gt;&lt;a href="{{ href|e }}"&gt;{{ caption|e }}&lt;/a&gt;&lt;/li&gt;
   {% endfor %}
&lt;/ul&gt;
</pre>

</div>

</div>

<div id="outline-container-7-4-3" class="outline-4">
<h4 id="sec-7-4-3"><span class="section-number-4">7.4.3</span> how I intend to show sweets</h4>
<div class="outline-text-4" id="text-7-4-3">

<p>Here is the template on which I will show the Sweets. Pls note that
it is enhancing the core or base template. 
</p>



<pre class="example">{% extends "coreLayout.html" %}
{% block body %}
  &lt;ul class=entries&gt;
  &lt;p&gt; Here is the Raw Sweet Array: {{ sweet_array }} &lt;/p&gt;
  &lt;h2&gt; here are your sweets: &lt;/h2&gt;
  {% for swt in sweet_array %}
     &lt;ul&gt; ID: {{ swt.id }} &lt;/ul&gt;
     &lt;ul&gt; Who: {{ swt.who }} &lt;/ul&gt;
     &lt;ul&gt; Context ID: {{ swt.context_id }} &lt;/ul&gt;
     &lt;ul&gt; What: {{ swt.what }} &lt;/ul&gt;
     &lt;ul&gt; Where: {{ swt.where }} &lt;/ul&gt;
     &lt;br&gt;
  {% else %}
    &lt;li&gt;&lt;em&gt;Unbelievable. No Sweets here so far!&lt;/em&gt;
  {% endfor %}
  &lt;/ul&gt;
{% endblock %}
</pre>


</div>

</div>

<div id="outline-container-7-4-4" class="outline-4">
<h4 id="sec-7-4-4"><span class="section-number-4">7.4.4</span> my page for getting Sweet User ID</h4>
<div class="outline-text-4" id="text-7-4-4">

<p>Authentication of the user is done by Mozilla Firefox Persona
utility. Here I am registering the ID that user may want to use for
composing Sweets. 
</p>


<pre class="example">&lt;!-- extend from base coreLayout.html --&gt;
{% extends "coreLayout.html" %}

{% block body %}
&lt;form action="" method="post" name="login"&gt;
     {{ form.hidden_tag() }}
     &lt;p&gt; Please enter your Sweet ID: &lt;br&gt;
         {{ form.usr_name(size=10) }}&lt;br&gt;
     &lt;/p&gt;

     &lt;p&gt;{{ form.remember_me }} Remember Me &lt;/p&gt;

     &lt;p&gt;&lt;input type="submit" value="Sign In"&gt;&lt;/p&gt;
&lt;/form&gt;
{% endblock %}
</pre>


</div>

</div>

<div id="outline-container-7-4-5" class="outline-4">
<h4 id="sec-7-4-5"><span class="section-number-4">7.4.5</span> Submit page</h4>
<div class="outline-text-4" id="text-7-4-5">

<p>Here is my submit page in HTML
</p>


<pre class="example">&lt;!--extend from base coreLayout.html --&gt;
{% extends "coreLayout.html" %}

{% block body %}
&lt;form method="POST" action="/"&gt;
    {{ form.hidden_tag }}
    {{ form.usr_name.label }} {{ form.usr_name(size=20) }}
    &lt;input type="submit" value="Go"&gt;
&lt;/form&gt;
{% endblock %}
</pre>


</div>

</div>

<div id="outline-container-7-4-6" class="outline-4">
<h4 id="sec-7-4-6"><span class="section-number-4">7.4.6</span> success page</h4>
<div class="outline-text-4" id="text-7-4-6">

</div>

</div>

<div id="outline-container-7-4-7" class="outline-4">
<h4 id="sec-7-4-7"><span class="section-number-4">7.4.7</span> Here is my success page in HTML</h4>
<div class="outline-text-4" id="text-7-4-7">




<pre class="example">&lt;!-- extend from base coreLayout.html --&gt;
{% extends "coreLayout.html" %}

{% block body %}
&lt;h1&gt;SweetSai Success page &lt;/h1&gt;
{% endblock %}
</pre>


</div>

</div>

<div id="outline-container-7-4-8" class="outline-4">
<h4 id="sec-7-4-8"><span class="section-number-4">7.4.8</span> my logout page</h4>
<div class="outline-text-4" id="text-7-4-8">

<p>Here is the code for my logout page<a name="sources" class="target">sources</a> 
</p>


<pre class="example">&lt;!-- extend from base coreLayout.html --&gt;
{% extends "coreLayout.html" %}

{% block body %}
&lt;h1&gt; this is the logOUT page &lt;/h1&gt;
{% endblock %}
</pre>


</div>

</div>

<div id="outline-container-7-4-9" class="outline-4">
<h4 id="sec-7-4-9"><span class="section-number-4">7.4.9</span> my LoginForm page</h4>
<div class="outline-text-4" id="text-7-4-9">




<pre class="example">&lt;!-- extend from base coreLayout.html --&gt;
{% extends "coreLayout.html" %}

{% block body %}
&lt;form action="" method="post" name="login"&gt;
     {{ form.hidden_tag() }}
     &lt;p&gt; Please enter your Sweet ID: &lt;br&gt;
         {{ form.usr_name(size=10) }}&lt;br&gt;
     &lt;/p&gt;

     &lt;p&gt;{{ form.remember_me }} Remember Me &lt;/p&gt;

     &lt;p&gt;&lt;input type="submit" value="Sign In"&gt;&lt;/p&gt;
&lt;/form&gt;
{% endblock %}
</pre>


</div>

</div>

<div id="outline-container-7-4-10" class="outline-4">
<h4 id="sec-7-4-10"><span class="section-number-4">7.4.10</span> style.css file</h4>
<div class="outline-text-4" id="text-7-4-10">

<p>Here is the style sheet that I use for my Mozilla Persona authorization
</p>


<pre class="example">
html {
    background: #eee;
}

body {
    font-family: 'Verdana', sans-serif;
    font-size: 15px;
    margin: 30px auto;
    width: 720px;
    background: white;
    padding: 30px;
}

h1 {
    margin: 0;
}

h1, h2, a {
    color: #d00;
}

div.authbar {
    background: #eee;
    padding: 0 15px;
    margin: 10px -15px;
    line-height: 25px;
    height: 25px;
    vertical-align: middle;
}

div.signinprogress {
    position: fixed;
    top: 0;
    left: 0;
    right: 0;
    bottom: 0;
    background: rgba(255, 255, 255, 0.8) url(spinner.png) center center no-repeat;
    font-size: 0;
}
</pre>



</div>
</div>
</div>

</div>

<div id="outline-container-8" class="outline-2">
<h2 id="sec-8"><span class="section-number-2">8</span> Client-side or Front-End Development work</h2>
<div class="outline-text-2" id="text-8">

<p>The front-end development work is being done using Angular JS
framework. It is being written in JavaScript. The page that is being
displayed, or the page which triggers the JavaScript is a HTML page.
</p>
<p>
The coding details of these two are discussed below.
</p>

</div>

<div id="outline-container-8-1" class="outline-3">
<h3 id="sec-8-1"><span class="section-number-3">8.1</span> JavaScript code for front-end</h3>
<div class="outline-text-3" id="text-8-1">

<p>Here is the code for the basic Angular JS APP component
</p>


<pre class="example">var app = angular.module('GetPage', []);

</pre>


<p>
This is the JavaScript code for the controller for the Angular JS app that I have created.
</p>


<pre class="example">
//exposing expose variables and functionality to expressions and directives in Template
app.controller('GetPageController', function ($scope, $http) { 
        $scope.inputURL = "http://teststore.swtr.us/";
        $scope.show = function() {
                var returnPromise = $http.get($scope.inputURL);
                returnPromise.then(
                    //success
                    function(data, status, headers, config) {
                           console.log("Server responded: Success in getting: ", $scope.inputURL);      
                           $scope.expression = data;
                           },
                        //error   
                    function(data, status, headers, config) {
               log($scope.inputURL);            
                           console.log("Server responded: Error in getting: ", $scope.inputURL);
                           },
                        //progress   
                        function(data, status, headers, config) {
                           console.log("Server responded: Progress in getting: ", $scope.inputURL);     
                           });
                log($scope.inputURL);      
                console.log("I created an Asynch call and am exiting the Show() function");     
                };
        });
</pre>


<p>
This function is used for logging debug messages directly to the HTML
page on the browser. 
</p>


<pre class="example">function log(str){
  var log = document.getElementById("log")
  if (log){ 
         // let's be safe...
     log.innerHTML += str + "&lt;br/&gt;";
     }
};
</pre>



</div>

</div>

<div id="outline-container-8-2" class="outline-3">
<h3 id="sec-8-2"><span class="section-number-3">8.2</span> HTML code for front-end</h3>
<div class="outline-text-3" id="text-8-2">

<p>Here is the HTML page that gets loaded to get / show Sweets.
</p>


<pre class="example">&lt;!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01//EN" 
 "http://www.w3.org/TR/html4/strict.dtd"&gt;
&lt;html&gt;
   &lt;head&gt;
      &lt;link href="//fonts.googleapis.com/css?family=Roboto:100,300"
            rel="stylesheet" type="text/css" /&gt;
      &lt;link rel="stylesheet" href={{ url_for('static', filename='css/SwtFrntStyle.css') }} /&gt;
   &lt;/head&gt;

   &lt;body data-ng-app="GetPage"&gt;
      &lt;div class="page-container" id="log" data-ng-controller="GetPageController"&gt;
         &lt;h2&gt; SaiGo's Sweet Page &lt;/h2&gt;
         &lt;div&gt; 
            input URL: &lt;input type="url" data-ng-model="inputURL" required&gt;
            &lt;button class="btn" data-ng-click="show()"&gt;Show&lt;/button&gt;
         &lt;/div&gt;
         &lt;div data-ng-bind-html-unsafe="expression"&gt; &lt;/div&gt;
      &lt;/div&gt;    
      &lt;script src="http://ajax.googleapis.com/ajax/libs/angularjs/1.3.14/angular.min.js"&gt; &lt;/script&gt;
      &lt;script src={{ url_for('static', filename='js/SwtFrntApp.js')   }}&gt;&lt;/script&gt;
      &lt;script src={{ url_for('static', filename='js/SwtFrntCntrl.js') }}&gt;&lt;/script&gt;
      &lt;script src={{ url_for('static', filename='js/SwtFrntLog.js')   }}&gt;&lt;/script&gt;
   &lt;/body&gt;

&lt;/html&gt;
</pre>


<p>
Here is the CSS file for the front end tool we are developing.
</p>


<pre class="example">* {
  box-sizing: border-box;
  font-family: 'Roboto', Arial;
  color: #95e2aa;
}

html, body {
  height: 100%;
  width: 100%;
}

body {
  background-attachment: scroll;
  background-clip: border-box;
  background-color: rgba(0, 0, 0, 0);
  background-image: url(http://subtlepatterns.com/patterns/stardust.png);
  background-origin: padding-box;
  background-size: auto;
}

.rebel {
  color: #ff6450;
}

.achieve {
  color: #9dc9a8;
}

.bt {
  width: 40px;
  border: none;
  cursor: pointer;
  outline: none;
}

.bt.bt-rebel {
  background: #ff6450;
  color: #fff;
}

.bt.bt-achieve {
  background: #9dc9a8;
  color: #444349;
}

.txt {
  background: transparent;
  width: 100%;
  outline: none;
  padding: 10px;
  margin: 4px 0;
  border: 1px solid #9dc9a8;
  width: 90%;
  font-size: 16px;
  position: relative;
  min-height: 100%;
}

.page-container {
  width: 90%;
  margin: 0 auto;
}

.page-container h2 {
  text-align: center;
  font-weight: 900;
}

.add-todo .txt {
  padding: 10px;
}

.todo-list, .add-todo {
  list-style-type: none;
  text-align: left;
}

.todo-list li {
  padding: 10px 80px 10px 10px;
  margin: 4px 0;
  border: 1px solid #9dc9a8;
  width: 90%;
  position: relative;
  min-height: 100%;
  cursor: pointer;
}

.todo-list li .bt {
  position: absolute;
  right: 0;
  top: 0;
  height: 100%;
  transition: width 0.4s ease-in-out;
}

.todo-list li .bt:hover {
  width: 80px;
}
</pre>



</div>
</div>

</div>

<div id="outline-container-9" class="outline-2">
<h2 id="sec-9"><span class="section-number-2">9</span> clipboard</h2>
<div class="outline-text-2" id="text-9">











</div>
</div>
</div>

<div id="postamble">
<p class="date">Date: 2016-03-02T15:05+0530</p>
<p class="author">Author: Sai Gollapudi</p>
<p class="creator"><a href="http://orgmode.org">Org</a> version 7.9.3f with <a href="http://www.gnu.org/software/emacs/">Emacs</a> version 24</p>
<a href="http://validator.w3.org/check?uri=referer">Validate XHTML 1.0</a>

</div>
</body>
</html>
